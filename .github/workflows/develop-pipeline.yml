name: Develop Pipeline

on:
  pull_request:
    branches:
      - develop

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout código
        uses: actions/checkout@v3

      - name: Verificar variáveis de ambiente
        run: |
          if [ -z "${{ secrets.SUPABASE_DEVELOP_URL }}" ] || [ -z "${{ secrets.SUPABASE_PASSWORD }}" ]; then
            echo "Erro: Variáveis de ambiente ausentes"
            exit 1
          fi

      - name: Instalar Supabase CLI
        run: |
          curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
          sudo apt-get install -y nodejs
          npm install -g supabase

      - name: Aplicar migrações no Supabase (Develop)
        run: |
          supabase db push --project-ref ${{ secrets.SUPABASE_PROJECT_REF }} --password ${{ secrets.SUPABASE_PASSWORD }}

      - name: Deploy para GitHub Pages (Develop)
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./ # Diretório onde o `index.html` está localizado
